{
  "$schema": "https://json-schema.org/draft-07/schema#",

  "title": "Text Source",

  "oneOf": [
    { "$ref": "#/$defs/find_file_source" },
    { "$ref": "#/$defs/plain_text_source" },
    { "$ref": "#/$defs/process_source" }
  ],

  "$defs": {
    "comment": {
      "description": "Any additional comment information",
      "type": "string"
    },
    "find_file_source": {
      "description": "Find files in a directory.",
      "type": "object",
      "properties": {
        "type": { "const": "find" },
        "comment": { "$ref": "#/$defs/comment" },
        "base": {
          "description": "Base directory for all subpaths (default: \".\")",
          "type": "string"
        },
        "paths": {
          "description": "Subpaths to search (default: [\".\"])",
          "type": "array",
          "items": { "type": "string" }
        },
        "file_pattern": {
          "description": "Regex for file names",
          "type": "string"
        },
        "dir_pattern": {
          "description": "Regex for directory names",
          "type": "string"
        }
      },
      "required": ["type"]
    },
    "plain_text_source": {
      "description": "Provide a list of plain texts directly.",
      "type": "object",
      "properties": {
        "type": { "const": "text" },
        "comment": { "$ref": "#/$defs/comment" },
        "texts": {
          "description": "Texts",
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "required": ["type", "texts"]
    },
    "process_source": {
      "description": "Apply operations to texts from sources.",
      "type": "object",
      "properties": {
        "type": { "const": "process" },
        "comment": { "$ref": "#/$defs/comment" },
        "operations": {
          "description": "Operations to be applied",
          "type": "array",
          "items": { "$ref": "./operation.schema.json" }
        },
        "sources": {
          "description": "Sources to which operations are applied",
          "type": "array",
          "items": { "$ref": "#" }
        }
      },
      "required": ["type", "operations", "sources"]
    }
  }
}
