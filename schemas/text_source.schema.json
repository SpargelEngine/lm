{
  "$schema": "https://json-schema.org/draft-07/schema#",

  "title": "Text Source",

  "oneOf": [
    { "$ref": "#/$defs/plain_text_source" },
    { "$ref": "#/$defs/process_source" }
  ],

  "$defs": {
    "plain_text_source": {
      "description": "Provide a list of plain texts directly.",
      "type": "object",
      "properties": {
        "type": { "const": "text" },
        "texts": {
          "description": "Texts",
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "required": ["type", "texts"]
    },
    "process_source": {
      "description": "Apply operations to texts from sources.",
      "type": "object",
      "properties": {
        "type": { "const": "process" },
        "operations": {
          "description": "Operations to be applied",
          "type": "array",
          "items": { "$ref": "#/$defs/operation" }
        },
        "sources": {
          "description": "Sources to which operations are applied",
          "type": "array",
          "items": { "$ref": "#" }
        }
      },
      "required": ["type", "operations", "sources"]
    },
    "operation": {
      "oneOf": [
        { "$ref": "#/$defs/read_file_operation" },
        { "$ref": "#/$defs/rstrip_operation" },
        { "$ref": "#/$defs/split_lines_operation" },
        { "$ref": "#/$defs/strip_operation" }
      ]
    },
    "read_file_operation": {
      "description": "Read file content.",
      "type": "object",
      "properties": {
        "type": { "const": "read_file" },
        "base": {
          "description": "Base path relative to which we find files (default: \".\")",
          "type": "string"
        },
        "encoding": {
          "description": "Encoding used by the files",
          "type": "string"
        },
        "compression": {
          "description": "Compression method used by the files",
          "enum": ["gzip"]
        }
      },
      "required": ["type"]
    },
    "rstrip_operation": {
      "description": "Right-strip text (remove trailing whitespace).",
      "type": "object",
      "properties": {
        "type": { "const": "rstrip" },
        "chars": {
          "description": "Characters to remove",
          "type": "string"
        }
      },
      "required": ["type"]
    },
    "split_lines_operation": {
      "description": "Split text into lines.",
      "type": "object",
      "properties": {
        "type": { "const": "split_lines" },
        "keep_ends": {
          "description": "Whether to keep line breaks (default: false)",
          "type": "boolean"
        }
      },
      "required": ["type"]
    },
    "strip_operation": {
      "description": "Strip text (remove leading and trailing whitespace).",
      "type": "object",
      "properties": {
        "type": { "const": "strip" },
        "chars": {
          "description": "Characters to remove",
          "type": "string"
        }
      },
      "required": ["type"]
    }
  }
}
